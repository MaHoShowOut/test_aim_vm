# Alibaba Cloud Linux 3.21.04 é¶æœºç¯å¢ƒéªŒè¯æµ‹è¯•æ¡†æ¶

## æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªä¸“ä¸ºAlibaba Cloud Linux 3.21.04é¶åœºç¯å¢ƒè®¾è®¡çš„è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œç”¨äºéªŒè¯é¶æœºåœ¨æ­£å¸¸å¯åŠ¨åå„ç³»ç»Ÿçš„å®Œæ•´æ€§å’Œå¯ç”¨æ€§ã€‚è¯¥æ¡†æ¶åŸºäºpytestæ„å»ºï¼Œæ¶µç›–ç³»ç»Ÿä¿¡æ¯ã€ç½‘ç»œè¿æ¥ã€æ–‡ä»¶ç³»ç»Ÿã€æœåŠ¡çŠ¶æ€ã€ç¡¬ä»¶èµ„æºç­‰å…³é”®æµ‹è¯•é¢†åŸŸã€‚
æ³¨æ„ï¼šdocæ–‡æ¡£ä¸‹æœ‰æ¼”ç¤ºè§†é¢‘å¯ä¾›å‚è€ƒæŸ¥çœ‹

## é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ VENV_README.md              # è™šæ‹Ÿç¯å¢ƒè¯¦ç»†ä½¿ç”¨æŒ‡å—
â”œâ”€â”€ README.md                   # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ TEST_ANALYSIS.md            # æµ‹è¯•ç‚¹åˆ†ææ–‡æ¡£
â”œâ”€â”€ PACKAGING_GUIDE.md          # taræ‰“åŒ…æŒ‡å—
â”œâ”€â”€ DEPLOYMENT_README.txt       # éƒ¨ç½²å’Œä½¿ç”¨æŒ‡å—
â”œâ”€â”€ requirements.txt            # Pythonä¾èµ–åŒ…åˆ—è¡¨ï¼ˆç‰ˆæœ¬é”å®šï¼‰
â”œâ”€â”€ requ2.txt                   # ä¸Šä¼ å·¥å…·ä¸“ç”¨ä¾èµ–åŒ…
â”œâ”€â”€ pytest.ini                 # pytesté…ç½®æ–‡ä»¶
â”œâ”€â”€ config.py                  # æµ‹è¯•é…ç½®å’Œå‚æ•°
â”œâ”€â”€ run_tests.py               # ä¸»æµ‹è¯•è¿è¡Œè„šæœ¬ï¼ˆæ”¯æŒvenvæ£€æµ‹ï¼‰
â”œâ”€â”€ run_tests_venv.sh          # venvä¸“ç”¨è¿è¡Œè„šæœ¬
â”œâ”€â”€ deploy_venv.sh             # è‡ªåŠ¨åŒ–venvéƒ¨ç½²è„šæœ¬
â”œâ”€â”€ deploy_and_test.sh         # è‡ªåŠ¨éƒ¨ç½²å’Œæµ‹è¯•è„šæœ¬
â””â”€â”€ tests/                     # æµ‹è¯•ç”¨ä¾‹ç›®å½•
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ test_system_info.py    # ç³»ç»Ÿä¿¡æ¯æµ‹è¯•
    â”œâ”€â”€ test_network.py        # ç½‘ç»œè¿æ¥æµ‹è¯•
    â”œâ”€â”€ test_services.py       # æœåŠ¡çŠ¶æ€æµ‹è¯•
    â””â”€â”€ test_hardware.py       # ç¡¬ä»¶èµ„æºæµ‹è¯•
```

## ä¸»è¦æµ‹è¯•é¢†åŸŸ

### 1. ç³»ç»ŸåŸºæœ¬ä¿¡æ¯æµ‹è¯• (`test_system_info.py`)
- æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆéªŒè¯
- å†…æ ¸ç‰ˆæœ¬æ£€æŸ¥
- ç³»ç»Ÿè¿è¡Œæ—¶é—´éªŒè¯
- ä¸»æœºåè§£ææµ‹è¯•
- ç³»ç»Ÿè´Ÿè½½ç›‘æ§
- SELinuxçŠ¶æ€æ£€æŸ¥

### 2. ç½‘ç»œè¿æ¥æ€§æµ‹è¯• (`test_network.py`)
- ç½‘ç»œæ¥å£çŠ¶æ€æ£€æŸ¥
- DNSè§£æåŠŸèƒ½éªŒè¯
- äº’è”ç½‘è¿æ¥æµ‹è¯•
- æœ¬åœ°å›ç¯è¿æ¥éªŒè¯
- ç½‘ç»œé…ç½®æ–‡ä»¶æ£€æŸ¥
- é˜²ç«å¢™çŠ¶æ€ç›‘æ§
- ç½‘ç»œè·¯ç”±é…ç½®éªŒè¯
- ç½‘ç»œç›‘å¬ç«¯å£æ£€æŸ¥

### 3. æœåŠ¡çŠ¶æ€æ£€æŸ¥æµ‹è¯• (`test_services.py`)
- å¿…éœ€ç³»ç»ŸæœåŠ¡è¿è¡ŒçŠ¶æ€éªŒè¯
- å…³é”®è¿›ç¨‹å­˜åœ¨æ€§æ£€æŸ¥
- systemdç³»ç»Ÿç®¡ç†å™¨çŠ¶æ€ç›‘æ§
- SSHæœåŠ¡é…ç½®éªŒè¯
- å®šæ—¶ä»»åŠ¡æœåŠ¡æ£€æŸ¥
- æ—¥å¿—æœåŠ¡çŠ¶æ€éªŒè¯
- ç½‘ç»œç®¡ç†æœåŠ¡æ£€æŸ¥
- åŒ…ç®¡ç†å™¨åŠŸèƒ½æµ‹è¯•

### 4. ç¡¬ä»¶èµ„æºå¯ç”¨æ€§æµ‹è¯• (`test_hardware.py`)
- CPUæ ¸å¿ƒæ•°é‡éªŒè¯
- å†…å­˜å¤§å°å’Œä½¿ç”¨æƒ…å†µæ£€æŸ¥
- CPUä½¿ç”¨ç‡ç›‘æ§
- ç£ç›˜I/OçŠ¶æ€æ£€æŸ¥
- ç½‘ç»œI/OçŠ¶æ€éªŒè¯
- ç³»ç»Ÿæ¸©åº¦ç›‘æ§ï¼ˆå¦‚æœå¯ç”¨ï¼‰
- è¿›ç¨‹æ•°é‡é™åˆ¶æ£€æŸ¥
- äº¤æ¢ç©ºé—´é…ç½®éªŒè¯
- CPUé¢‘ç‡æ£€æŸ¥
- ç¡¬ä»¶åŸºæœ¬ä¿¡æ¯éªŒè¯

## ç¯å¢ƒè¦æ±‚

- Python 3.6+
- Alibaba Cloud Linux 3.21.04
- rootæƒé™ï¼ˆæ¨èï¼‰æˆ–é€‚å½“çš„sudoæƒé™

## å¿«é€Ÿéƒ¨ç½²

### æ–¹å¼ä¸€ï¼šä½¿ç”¨é¢„æ‰“åŒ…ç¯å¢ƒï¼ˆæ¨èï¼‰

1. **è·å–æ‰“åŒ…æ–‡ä»¶**: `test_env .tar.gz`
2. **ä¼ è¾“åˆ°é¶æœº**: `scp "test_env .tar.gz" root@target-host:/opt/`
3. **è§£å‹è¿è¡Œ**: å‚è€ƒ `DEPLOYMENT_README.txt` è¿›è¡Œå®Œæ•´éƒ¨ç½²

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨ç¯å¢ƒæ­å»º

1. **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**: `python3 -m venv test_env`
2. **å®‰è£…ä¾èµ–**: `pip install -r requirements.txt`
3. **è¿è¡Œæµ‹è¯•**: `python run_tests.py`

è¯¦ç»†çš„æ‰“åŒ…å’Œéƒ¨ç½²è¯´æ˜è¯·å‚è€ƒï¼š
- `doc/PACKAGING_GUIDE.md` - taræ‰“åŒ…æŒ‡å—
- `doc/VENV_README.md` - è™šæ‹Ÿç¯å¢ƒè¯¦ç»†ä½¿ç”¨æŒ‡å—
- `DEPLOYMENT_README.txt` - éƒ¨ç½²å’Œä½¿ç”¨æŒ‡å—

## è™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰

é¡¹ç›®æ¨èä½¿ç”¨Pythonè™šæ‹Ÿç¯å¢ƒ(venv)æ¥ç®¡ç†ä¾èµ–åŒ…ï¼Œæä¾›æ›´å¥½çš„ç¯å¢ƒéš”ç¦»å’Œç‰ˆæœ¬æ§åˆ¶ã€‚

### å¿«é€Ÿå¼€å§‹

#### æ‰‹åŠ¨åˆ›å»ºvenvç¯å¢ƒ

```bash
# 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv test_env

# 2. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source test_env/bin/activate  # Linux/macOS

# 3. å‡çº§pipï¼ˆæ¨èï¼‰
pip install --upgrade pip

# 4. å®‰è£…wheelåŒ…ï¼ˆå¯é€‰ï¼Œæé«˜å®‰è£…é€Ÿåº¦ï¼‰
pip install wheel

# 5. å®‰è£…é¡¹ç›®ä¾èµ–
pip install -r requirements.txt

# 6. éªŒè¯å®‰è£…
python -c "import pytest, psutil, requests; print('âœ… ä¾èµ–å®‰è£…æˆåŠŸ')"

# 7. è¿è¡Œæµ‹è¯•
python run_tests.py

# 8. é€€å‡ºè™šæ‹Ÿç¯å¢ƒ
deactivate
```

#### æ‰“åŒ…venvç¯å¢ƒï¼ˆç”¨äºéƒ¨ç½²ï¼‰

```bash
# æ¿€æ´»ç¯å¢ƒåæ‰“åŒ…
source test_env/bin/activate
pip freeze > test_env/requirements_installed.txt
deactivate

# æ‰“åŒ…æ•´ä¸ªvenvç›®å½•
tar -czf test_env.tar.gz test_env/
```

### ä½¿ç”¨ä¸“ç”¨è„šæœ¬

```bash
# è‡ªåŠ¨æ£€æµ‹å’Œä½¿ç”¨venvç¯å¢ƒ
./run_tests_venv.sh

# æˆ–æŒ‡å®šè‡ªå®šä¹‰venvè·¯å¾„
./run_tests_venv.sh --venv-path /custom/path/to/venv
```

### è‡ªåŠ¨åŒ–å·¥å…·

é¡¹ç›®æä¾›äº†è‡ªåŠ¨åŒ–è„šæœ¬ç®€åŒ–venvç®¡ç†ï¼š

```bash
# éƒ¨ç½²venvåˆ°é¶æœº
./deploy_venv.sh target-host-01

# ä½¿ç”¨venvè¿è¡Œæµ‹è¯•
./run_tests_venv.sh
```

ğŸ“– **è¯¦ç»†æ–‡æ¡£**: è§ [`VENV_README.md`](VENV_README.md)

## ä¼ ç»Ÿå®‰è£…æ–¹å¼

å¦‚æœä¸ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼Œå¯ä»¥ç›´æ¥å®‰è£…ä¾èµ–åŒ…ï¼š

```bash
pip install -r requirements.txt
```

## ä½¿ç”¨æ–¹æ³•

### ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒè¿è¡Œæµ‹è¯•ï¼ˆæ¨èï¼‰

```bash
# æ–¹æ³•1ï¼šä½¿ç”¨ä¸“ç”¨venvè„šæœ¬ï¼ˆè‡ªåŠ¨æ£€æµ‹venvï¼‰
./run_tests_venv.sh

# æ–¹æ³•2ï¼šæ¿€æ´»venvåè¿è¡Œ
source test_env/bin/activate
python run_tests.py

# æ–¹æ³•3ï¼šç›´æ¥ä½¿ç”¨venvä¸­çš„python
/opt/test_env/bin/python3 run_tests.py
```

### æœ¬åœ°è¿è¡Œæµ‹è¯•

å¦‚æœä½¿ç”¨ä¼ ç»Ÿæ–¹å¼ï¼ˆä¸æ¨èï¼‰ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»åˆ«
pytest -m system        # ç³»ç»Ÿæµ‹è¯•
pytest -m network       # ç½‘ç»œæµ‹è¯•
pytest -m service       # æœåŠ¡æµ‹è¯•
pytest -m hardware      # ç¡¬ä»¶æµ‹è¯•

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pytest tests/test_system_info.py

# ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
pytest --tb=long -v

# ç”ŸæˆHTMLæŠ¥å‘Šï¼ˆéœ€è¦é¢å¤–å®‰è£…pytest-htmlï¼‰
pytest --html=report.html
```

### è¿œç¨‹é¶æœºæµ‹è¯•

æ¡†æ¶æ”¯æŒé€šè¿‡SSHåœ¨è¿œç¨‹é¶æœºä¸Šè¿è¡Œæµ‹è¯•ï¼š

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export TEST_MODE=remote
export REMOTE_HOST=your_target_ip
export REMOTE_USER=root
export SSH_KEY_PATH=~/.ssh/id_rsa

# è¿è¡Œè¿œç¨‹æµ‹è¯•
pytest
```

## é…ç½®è¯´æ˜

### ä¸»è¦é…ç½®æ–‡ä»¶

- `config.py`: æµ‹è¯•å‚æ•°å’Œé˜ˆå€¼é…ç½®
- `pytest.ini`: pytestæµ‹è¯•æ¡†æ¶é…ç½®
- `requirements.txt`: Pythonä¾èµ–åŒ…åˆ—è¡¨

### å¯é…ç½®å‚æ•°

åœ¨`config.py`ä¸­å¯ä»¥è°ƒæ•´ï¼š

- æœŸæœ›çš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬
- ç½‘ç»œè¶…æ—¶è®¾ç½®
- ç£ç›˜ç©ºé—´æœ€ä½è¦æ±‚
- å†…å­˜å’ŒCPUæœ€ä½é…ç½®
- æœåŠ¡æ£€æŸ¥åˆ—è¡¨
- æ–‡ä»¶æƒé™è¦æ±‚

## æµ‹è¯•ç»“æœè§£é‡Š

### æˆåŠŸæ ‡å‡†

- æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡
- ç³»ç»Ÿå„ç»„ä»¶è¿è¡Œæ­£å¸¸
- èµ„æºä½¿ç”¨åœ¨åˆç†èŒƒå›´å†…
- ç½‘ç»œè¿æ¥æ­£å¸¸
- æ–‡ä»¶ç³»ç»Ÿå®Œæ•´

### å¸¸è§å¤±è´¥åŸå› 

1. **æƒé™ä¸è¶³**: éœ€è¦rootæƒé™è®¿é—®ç³»ç»Ÿæ–‡ä»¶
2. **ç½‘ç»œé—®é¢˜**: DNSè§£æå¤±è´¥æˆ–ç½‘ç»œè¿æ¥å¼‚å¸¸
3. **æœåŠ¡æœªå¯åŠ¨**: å…³é”®ç³»ç»ŸæœåŠ¡æœªè¿è¡Œ
4. **èµ„æºä¸è¶³**: å†…å­˜æˆ–ç£ç›˜ç©ºé—´ä¸è¶³
5. **é…ç½®é—®é¢˜**: ç³»ç»Ÿé…ç½®æ–‡ä»¶ç¼ºå¤±æˆ–é”™è¯¯

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„æµ‹è¯•ç”¨ä¾‹

1. åœ¨`tests/`ç›®å½•ä¸‹åˆ›å»ºæ–°çš„æµ‹è¯•æ–‡ä»¶
2. éµå¾ªç°æœ‰çš„å‘½åè§„èŒƒï¼š`test_*.py`
3. ä½¿ç”¨é€‚å½“çš„pytestæ ‡è®°
4. åœ¨`config.py`ä¸­æ·»åŠ ç›¸å…³é…ç½®å‚æ•°

### ç¤ºä¾‹ï¼šæ·»åŠ è‡ªå®šä¹‰æµ‹è¯•

```python
import pytest
from config import Config

class TestCustomChecks:
    @pytest.mark.custom
    def test_custom_validation(self):
        # è‡ªå®šä¹‰æµ‹è¯•é€»è¾‘
        assert True
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ImportError**: ç¡®ä¿å·²å®‰è£…æ‰€æœ‰ä¾èµ–åŒ…
2. **PermissionError**: ä»¥rootæƒé™è¿è¡Œæˆ–é…ç½®é€‚å½“çš„sudoæƒé™
3. **TimeoutError**: å¢åŠ `config.py`ä¸­çš„è¶…æ—¶è®¾ç½®
4. **NetworkError**: æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒDNSé…ç½®

### æ—¥å¿—å’Œè°ƒè¯•

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
pytest -v -s

# åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•
pytest --lf

# æ˜¾ç¤ºæµ‹è¯•æ‰§è¡Œæ—¶é—´
pytest --durations=10
```

## è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ªMITè®¸å¯è¯ã€‚

## è´¡çŒ®

æ¬¢è¿æäº¤é—®é¢˜å’Œæ”¹è¿›å»ºè®®ã€‚è¯·ç¡®ä¿æ‰€æœ‰æ–°ä»£ç éƒ½åŒ…å«ç›¸åº”çš„æµ‹è¯•ç”¨ä¾‹ã€‚
